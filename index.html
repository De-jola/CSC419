<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smart Home Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        --bg: #f8fafc;
        --white: #ffffff;
        --blue: #3b82f6;
        --green: #10b981;
        --orange: #f59e0b;
        --purple: #8b5cf6;
      }

      body {
        font-family: system-ui, sans-serif;
        background: var(--bg);
        margin: 0;
        padding: 15px;
      }
      .header {
        text-align: center;
        margin-bottom: 20px;
      }

      /* Responsive Grid */
      .room-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 15px;
        margin-bottom: 25px;
      }

      .card {
        background: var(--white);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        border-top: 5px solid var(--blue);
      }

      .mode {
        float: right;
        font-size: 0.7rem;
        font-weight: bold;
        padding: 4px 8px;
        border-radius: 20px;
      }
      .auto {
        background: #dcfce7;
        color: #166534;
      }
      .manual {
        background: #fee2e2;
        color: #991b1b;
      }

      .stat {
        display: flex;
        justify-content: space-between;
        margin: 10px 0;
      }
      .pill {
        padding: 3px 8px;
        border-radius: 5px;
        font-size: 0.75rem;
        font-weight: bold;
      }
      .ON,
      .COOLING,
      .Occupied {
        background: #dcfce7;
        color: #166534;
      }
      .OFF,
      .Empty {
        background: #f1f5f9;
        color: #64748b;
      }
      .STANDBY {
        background: #fef9c3;
        color: #854d0e;
      }

      .controls {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-top: 15px;
      }
      button {
        cursor: pointer;
        border: none;
        padding: 10px;
        border-radius: 8px;
        font-weight: bold;
      }
      .btn-ac {
        background: #e0f2fe;
        color: #0369a1;
      }
      .btn-light {
        background: #f0fdf4;
        color: #15803d;
      }
      .btn-res {
        grid-column: span 2;
        background: var(--blue);
        color: white;
        margin-top: 5px;
      }

      .charts {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
      }
      .chart-box {
        background: white;
        padding: 15px;
        border-radius: 12px;
        height: 300px;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>Smart Home Energy</h1>
      <p>Live Monitoring Dashboard</p>
    </div>

    <div class="room-grid" id="room-grid"></div>

    <div class="charts">
      <div class="chart-box"><canvas id="tempChart"></canvas></div>
      <div class="chart-box"><canvas id="energyChart"></canvas></div>
    </div>

    <script>
      const rooms = ["Living Room", "Bedroom", "Kitchen", "Office"];
      const colors = ["#3b82f6", "#10b981", "#f59e0b", "#8b5cf6"];

      // Initialize with simple Dummy Data
      const state = rooms.map((name, i) => ({
        name,
        color: colors[i],
        temp: 24 + i, // Dummy temp
        occupied: i % 2 === 0, // Alternate occupancy
        light: 400 + i * 100, // Dummy light levels
        acState: "OFF",
        lightState: "OFF",
        isAuto: true,
        history: Array(10).fill(24 + i),
      }));

      function runLogic(r) {
        if (!r.isAuto) return;

        // AC FSM Logic
        if (!r.occupied) r.acState = "OFF";
        else {
          if (r.acState === "OFF")
            r.acState = r.temp >= 28 ? "COOLING" : "STANDBY";
          else if (r.acState === "STANDBY" && r.temp >= 28)
            r.acState = "COOLING";
          else if (r.acState === "COOLING" && r.temp < 24)
            r.acState = "STANDBY";
        }
        // Light FSM Logic
        r.lightState = r.occupied && r.light < 300 ? "ON" : "OFF";
      }

      function toggle(idx, type) {
        const r = state[idx];
        r.isAuto = false;
        if (type === "ac") r.acState = r.acState === "OFF" ? "COOLING" : "OFF";
        if (type === "light")
          r.lightState = r.lightState === "OFF" ? "ON" : "OFF";
        render();
      }

      function resume(idx) {
        state[idx].isAuto = true;
        render();
      }

      function render() {
        const grid = document.getElementById("room-grid");
        grid.innerHTML = state
          .map(
            (r, i) => `
            <div class="card" style="border-top-color: ${r.color}">
                <span class="mode ${r.isAuto ? "auto" : "manual"}">${r.isAuto ? "AUTO" : "MANUAL"}</span>
                <h3>${r.name}</h3>
                <div class="stat"><span>Temp</span><b>${r.temp.toFixed(1)}Â°C</b></div>
                <div class="stat"><span>Presence</span><span class="pill ${r.occupied ? "Occupied" : "Empty"}">${r.occupied ? "Occupied" : "Empty"}</span></div>
                <div class="stat"><span>Light Level</span><b>${r.light}</b></div>
                <div class="stat"><span>AC State</span><span class="pill ${r.acState}">${r.acState}</span></div>
                <div class="stat"><span>Lights</span><span class="pill ${r.lightState}">${r.lightState}</span></div>
                <div class="controls">
                    <button class="btn-ac" onclick="toggle(${i}, 'ac')">AC</button>
                    <button class="btn-light" onclick="toggle(${i}, 'light')">Light</button>
                    ${!r.isAuto ? `<button class="btn-res" onclick="resume(${i})">Resume Auto</button>` : ""}
                </div>
            </div>
        `,
          )
          .join("");
      }

      // Chart Setup
      const tCtx = document.getElementById("tempChart").getContext("2d");
      const eCtx = document.getElementById("energyChart").getContext("2d");
      const tempChart = new Chart(tCtx, {
        type: "line",
        data: {
          labels: Array(10).fill(""),
          datasets: state.map((r) => ({
            label: r.name,
            data: r.history,
            borderColor: r.color,
            tension: 0.3,
          })),
        },
        options: { maintainAspectRatio: false },
      });
      const energyChart = new Chart(eCtx, {
        type: "bar",
        data: {
          labels: rooms,
          datasets: [
            { label: "kWh", data: [12, 15, 8, 10], backgroundColor: colors },
          ],
        },
        options: { maintainAspectRatio: false },
      });

      // Simple Dummy Data Update Loop
      setInterval(() => {
        state.forEach((r, i) => {
          // Just slightly move dummy data for visual effect
          r.temp += (Math.random() - 0.5) * 0.5;
          r.light = Math.floor(Math.random() * 1000);
          if (Math.random() > 0.95) r.occupied = !r.occupied;

          runLogic(r);
          r.history.push(r.temp);
          r.history.shift();
          tempChart.data.datasets[i].data = r.history;
        });
        tempChart.update("none");
        render();
      }, 2000);

      render();
    </script>
  </body>
</html>
