<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Smart Home Energy Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        --bg: #f1f5f9;
        --card: #ffffff;
        --room-0: #3b82f6;
        --room-1: #10b981;
        --room-2: #f59e0b;
        --room-3: #8b5cf6;
      }
      body {
        font-family: "Inter", sans-serif;
        background: var(--bg);
        padding: 20px;
        color: #1e293b;
      }
      .header {
        text-align: center;
        margin-bottom: 25px;
      }
      .room-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }
      .card {
        background: var(--card);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        position: relative;
      }
      .card-0 {
        border-top: 5px solid var(--room-0);
      }
      .card-1 {
        border-top: 5px solid var(--room-1);
      }
      .card-2 {
        border-top: 5px solid var(--room-2);
      }
      .card-3 {
        border-top: 5px solid var(--room-3);
      }
      .mode-indicator {
        float: right;
        font-size: 0.7rem;
        padding: 4px 10px;
        border-radius: 20px;
        font-weight: bold;
      }
      .mode-auto {
        background: #dcfce7;
        color: #166534;
      }
      .mode-manual {
        background: #fee2e2;
        color: #991b1b;
      }
      .stat {
        display: flex;
        justify-content: space-between;
        margin: 10px 0;
        font-size: 0.9rem;
      }
      .pill {
        padding: 3px 10px;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: bold;
      }
      .ON,
      .COOLING,
      .Occupied {
        background: #dcfce7;
        color: #166534;
      }
      .OFF,
      .Empty {
        background: #f1f5f9;
        color: #64748b;
      }
      .STANDBY {
        background: #fef9c3;
        color: #854d0e;
      }
      .controls {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-top: 15px;
      }
      button {
        cursor: pointer;
        border: none;
        padding: 10px;
        border-radius: 8px;
        font-weight: bold;
        transition: 0.2s;
      }
      .btn-ac {
        background: #e0f2fe;
        color: #0369a1;
      }
      .btn-light {
        background: #f0fdf4;
        color: #15803d;
      }
      .btn-resume {
        grid-column: span 2;
        background: #3b82f6;
        color: white;
        margin-top: 5px;
      }
      .charts {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }
      .chart-container {
        background: white;
        padding: 15px;
        border-radius: 12px;
        height: 320px;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>Smart Home Energy Management Dashboard</h1>
      <p
        id="clock"
        style="font-weight: bold; font-size: 1.2rem; color: #3b82f6"
      >
        14:00
      </p>
    </div>

    <div class="room-grid" id="room-grid"></div>

    <div class="charts">
      <div class="chart-container"><canvas id="tempChart"></canvas></div>
      <div class="chart-container"><canvas id="energyChart"></canvas></div>
    </div>

    <script>
      const rooms = ["Living Room", "Bedroom", "Kitchen", "Home Office"];
      const roomColors = ["#3b82f6", "#10b981", "#f59e0b", "#8b5cf6"];
      const baseTemps = [22, 28, 32, 25]; // Different baselines to spread chart lines
      let hour = 13;

      const state = rooms.map((name, i) => ({
        name,
        color: roomColors[i],
        temp: baseTemps[i],
        baseAmbient: baseTemps[i],
        occupied: false,
        light: 450,
        acState: "OFF",
        lightState: "OFF",
        isAuto: true,
        history: Array(20).fill(baseTemps[i]),
      }));

      function updatePhysics(r) {
        // 1. Calculate the Target Ambient Temp based on time of day (Sine wave)
        // Peak heat at 14:00 (2 PM)
        const timeEffect = Math.sin(((hour - 8) * Math.PI) / 12) * 5;
        const targetAmbient = r.baseAmbient + timeEffect;

        // 2. Apply AC Cooling or Natural Heating
        if (r.acState === "COOLING") {
          // AC is powerful: drops temp by 0.8 degrees per tick
          if (r.temp > 16) r.temp -= 0.8;
          else r.temp = 16; // Minimum floor
        } else {
          // Natural drift towards ambient if AC is off
          if (r.temp < targetAmbient) r.temp += 0.2;
          if (r.temp > targetAmbient) r.temp -= 0.1;
        }

        // Add tiny bit of jitter
        r.temp += (Math.random() - 0.5) * 0.1;
      }

      function updateFSM(r) {
        if (!r.isAuto) return;
        if (!r.occupied) r.acState = "OFF";
        else {
          if (r.acState === "OFF")
            r.acState = r.temp >= 28 ? "COOLING" : "STANDBY";
          else if (r.acState === "STANDBY" && r.temp >= 28)
            r.acState = "COOLING";
          else if (r.acState === "COOLING" && r.temp < 24)
            r.acState = "STANDBY";
        }
        r.lightState = r.occupied && r.light < 300 ? "ON" : "OFF";
      }

      function toggleAppliance(idx, type) {
        const r = state[idx];
        r.isAuto = false;
        if (type === "ac") r.acState = r.acState === "OFF" ? "COOLING" : "OFF";
        if (type === "light")
          r.lightState = r.lightState === "OFF" ? "ON" : "OFF";
        render();
      }

      function resumeAuto(idx) {
        state[idx].isAuto = true;
        render();
      }

      function render() {
        const grid = document.getElementById("room-grid");
        grid.innerHTML = state
          .map(
            (r, i) => `
            <div class="card card-${i}">
                <div class="mode-indicator ${r.isAuto ? "mode-auto" : "mode-manual"}">${r.isAuto ? "● AUTO" : "● MANUAL"}</div>
                <h3>${r.name}</h3>
                <div class="stat"><span>Temperature</span><b style="color:${r.temp > 27 ? "red" : "green"}">${r.temp.toFixed(1)}°C</b></div>
                <div class="stat"><span>Presence</span><span class="pill ${r.occupied ? "Occupied" : "Empty"}">${r.occupied ? "Occupied" : "Empty"}</span></div>
                <div class="stat"><span>Light Level</span><b>${Math.round(r.light)}</b></div>
                <div class="stat"><span>AC State</span><span class="pill ${r.acState}">${r.acState}</span></div>
                <div class="stat"><span>Lights</span><span class="pill ${r.lightState}">${r.lightState}</span></div>
                <div class="controls">
                    <button class="btn-ac" onclick="toggleAppliance(${i}, 'ac')">Toggle AC</button>
                    <button class="btn-light" onclick="toggleAppliance(${i}, 'light')">Toggle Light</button>
                    ${!r.isAuto ? `<button class="btn-resume" onclick="resumeAuto(${i})">↺ Resume Auto</button>` : ""}
                </div>
            </div>
        `,
          )
          .join("");
      }

      const tCtx = document.getElementById("tempChart").getContext("2d");
      const eCtx = document.getElementById("energyChart").getContext("2d");
      const tempChart = new Chart(tCtx, {
        type: "line",
        data: {
          labels: Array(20).fill(""),
          datasets: state.map((r, i) => ({
            label: r.name,
            data: r.history,
            borderColor: r.color,
            backgroundColor: r.color + "11",
            fill: true,
            tension: 0.3,
          })),
        },
        options: {
          maintainAspectRatio: false,
          scales: { y: { min: 14, max: 40 } },
        },
      });

      const energyChart = new Chart(eCtx, {
        type: "bar",
        data: {
          labels: rooms,
          datasets: [
            {
              label: "kWh",
              data: [14, 22, 10, 15],
              backgroundColor: roomColors,
            },
          ],
        },
        options: { maintainAspectRatio: false },
      });

      setInterval(() => {
        hour = (hour + 0.1) % 24;
        document.getElementById("clock").innerText =
          `${Math.floor(hour).toString().padStart(2, "0")}:00`;
        state.forEach((r, i) => {
          if (Math.random() > 0.98) r.occupied = !r.occupied;
          updatePhysics(r);
          updateFSM(r);
          r.history.push(r.temp);
          r.history.shift();
          tempChart.data.datasets[i].data = r.history;
        });
        tempChart.update("none");
        render();
      }, 2000);
      render();
    </script>
  </body>
</html>
